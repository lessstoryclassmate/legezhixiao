# ğŸš¨ ç´§æ€¥ä¿®å¤ï¼šSSHå¯†é’¥é…ç½®æ··æ·†é—®é¢˜

## é—®é¢˜è¯Šæ–­
**å‘ç°é—®é¢˜**: ä¹‹å‰çš„é…ç½®æ–‡æ¡£é”™è¯¯åœ°æ··æ·†äº†ä¸¤ç§ä¸åŒç”¨é€”çš„SSHå¯†é’¥ï¼

## ç«‹å³ä¿®å¤æ­¥éª¤

### ç¬¬1æ­¥ï¼šç”ŸæˆGitHub Actionséƒ¨ç½²å¯†é’¥ ğŸ”‘

åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œï¼š
```bash
# ç”Ÿæˆä¸“é—¨ç”¨äºGitHub Actionsâ†’æœåŠ¡å™¨è¿æ¥çš„å¯†é’¥
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_actions_deploy_key

# æ˜¾ç¤ºç§é’¥å†…å®¹ï¼ˆç”¨äºGitHub Secretsï¼‰
echo "=== ç§é’¥å†…å®¹ (å¤åˆ¶åˆ°GitHub Secrets) ==="
cat ~/.ssh/github_actions_deploy_key

echo ""
echo "=== å…¬é’¥å†…å®¹ (æ·»åŠ åˆ°æœåŠ¡å™¨) ==="
cat ~/.ssh/github_actions_deploy_key.pub
```

### ç¬¬2æ­¥ï¼šé…ç½®æœåŠ¡å™¨æ¥å—éƒ¨ç½²è¿æ¥ ğŸ–¥ï¸

åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š
```bash
# åˆ›å»ºSSHç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir -p /root/.ssh
chmod 700 /root/.ssh

# å°†GitHub Actionséƒ¨ç½²å¯†é’¥çš„å…¬é’¥æ·»åŠ åˆ°authorized_keys
# æ³¨æ„ï¼šä½¿ç”¨æ‚¨ä»ç¬¬1æ­¥è·å¾—çš„å…¬é’¥å†…å®¹
echo "ssh-ed25519 AAAA... github-actions-deploy" >> /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys
```

### ç¬¬3æ­¥ï¼šæ›´æ–°GitHub Secrets ğŸ”§

åœ¨GitHubä»“åº“è®¾ç½®ä¸­ï¼š
1. è¿›å…¥ `Settings` â†’ `Secrets and variables` â†’ `Actions`
2. æ›´æ–° `SERVER_SSH_KEY` çš„å€¼ä¸º**ç¬¬1æ­¥ç”Ÿæˆçš„ç§é’¥å†…å®¹**
3. ç¡®è®¤å…¶ä»–secretsæ­£ç¡®ï¼š
   - `SERVER_IP`: æ‚¨çš„æœåŠ¡å™¨IPåœ°å€
   - `SERVER_USER`: `root`

### ç¬¬4æ­¥ï¼šç¡®è®¤æœåŠ¡å™¨Gitå¯†é’¥é…ç½® ğŸ“‹

åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šæ£€æŸ¥ï¼š
```bash
# æ£€æŸ¥Gitå¯†é’¥æ˜¯å¦å­˜åœ¨
ls -la /root/.ssh/id_ed25519*

# å¦‚æœä¸å­˜åœ¨ï¼Œç”ŸæˆGitå¯†é’¥
if [ ! -f /root/.ssh/id_ed25519 ]; then
    ssh-keygen -t ed25519 -C "server-git-access" -f /root/.ssh/id_ed25519
fi

# æ˜¾ç¤ºGitå…¬é’¥ï¼ˆéœ€è¦æ·»åŠ åˆ°GitHubè´¦æˆ·ï¼‰
echo "=== å°†æ­¤å…¬é’¥æ·»åŠ åˆ°GitHubè´¦æˆ·SSHå¯†é’¥è®¾ç½® ==="
cat /root/.ssh/id_ed25519.pub

# æµ‹è¯•GitHubè¿æ¥
ssh -T git@github.com
```

### ç¬¬5æ­¥ï¼šæµ‹è¯•éƒ¨ç½²è¿æ¥ ğŸ§ª

ä»æœ¬åœ°æµ‹è¯•GitHub Actionsèƒ½å¦è¿æ¥æœåŠ¡å™¨ï¼š
```bash
# ä½¿ç”¨ç”Ÿæˆçš„éƒ¨ç½²å¯†é’¥æµ‹è¯•è¿æ¥
ssh -i ~/.ssh/github_actions_deploy_key root@æ‚¨çš„æœåŠ¡å™¨IP

# å¦‚æœæˆåŠŸè¿æ¥ï¼Œè¯´æ˜é…ç½®æ­£ç¡®
```

## é…ç½®æ€»ç»“ ğŸ“Š

| ç”¨é€” | å¯†é’¥æ–‡ä»¶ | ç”¨äº | é…ç½®ä½ç½® |
|------|----------|------|----------|
| **éƒ¨ç½²è¿æ¥** | `github_actions_deploy_key` | GitHub Actions â†’ æœåŠ¡å™¨ | GitHub Secrets: `SERVER_SSH_KEY` |
| **ä»£ç å…‹éš†** | `/root/.ssh/id_ed25519` | æœåŠ¡å™¨ â†’ GitHubä»“åº“ | æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿ + GitHubè´¦æˆ·SSHå¯†é’¥ |

## éªŒè¯æ¸…å• âœ…

- [ ] ç”Ÿæˆäº†ä¸“é—¨çš„GitHub Actionséƒ¨ç½²å¯†é’¥
- [ ] éƒ¨ç½²å¯†é’¥çš„å…¬é’¥å·²æ·»åŠ åˆ°æœåŠ¡å™¨authorized_keys  
- [ ] éƒ¨ç½²å¯†é’¥çš„ç§é’¥å·²è®¾ç½®åˆ°GitHub Secrets
- [ ] æœåŠ¡å™¨Gitå¯†é’¥å·²é…ç½®å¹¶æµ‹è¯•é€šè¿‡
- [ ] ä¸¤ç§å¯†é’¥ç”¨é€”å®Œå…¨åˆ†ç¦»

## ä¸‹æ¬¡éƒ¨ç½²
ç°åœ¨GitHub Actionsä½¿ç”¨æ­£ç¡®çš„éƒ¨ç½²å¯†é’¥ï¼Œåº”è¯¥èƒ½å¤ŸæˆåŠŸè¿æ¥æœåŠ¡å™¨å¹¶å®Œæˆéƒ¨ç½²ï¼

---
**å…³é”®è¦ç‚¹**: éƒ¨ç½²å¯†é’¥ â‰  Gitå¯†é’¥ã€‚ä¸¤è€…ç”¨é€”ä¸åŒï¼Œç»ä¸èƒ½æ··æ·†ï¼
