# 📋 GitHub Actions 工作流解释

## 为什么有两个部署环节？

项目中有两个不同的部署环节：`deploy` 和 `deploy-dev`，它们服务于不同的用途和环境。

## 🔍 详细分析

### 1. **deploy** (生产环境部署)
- **触发条件**: 当代码推送到 `main` 分支时
- **目标环境**: 生产环境 (百度云服务器)
- **执行条件**: `if: github.ref == 'refs/heads/main' && github.event_name == 'push'`
- **部署地址**: 正式的生产服务器

### 2. **deploy-dev** (开发环境部署)  
- **触发条件**: 当代码推送到 `develop` 分支时
- **目标环境**: 开发环境
- **执行条件**: `if: github.ref == 'refs/heads/develop' && github.event_name == 'push'`
- **部署地址**: 开发测试服务器

## 📊 工作流结构图

```
GitHub Actions 工作流程
│
├── 📝 quality-check (代码质量检查)
│   ├── Python 代码检查 (flake8)
│   ├── Frontend 代码检查 (npm run lint)
│   └── 依赖安装测试
│
├── 🔨 build (构建测试)
│   ├── Docker 镜像构建
│   ├── 容器启动测试
│   └── 基础健康检查
│
├── 🚀 deploy (生产部署) - 仅 main 分支
│   ├── SSH 连接设置
│   ├── 服务器连接检查
│   ├── 代码部署
│   ├── 环境变量配置
│   ├── Docker 服务启动
│   └── 健康检查
│
└── 🧪 deploy-dev (开发部署) - 仅 develop 分支
    └── 开发环境部署逻辑
```

## 🎯 使用场景

### 生产环境 (deploy)
- **用途**: 正式对外服务的环境
- **稳定性**: 要求高稳定性和可靠性
- **部署频率**: 相对较少，经过充分测试后才部署
- **访问地址**: http://106.13.216.179:80

### 开发环境 (deploy-dev)
- **用途**: 开发团队测试新功能
- **稳定性**: 可以容忍一定的不稳定性
- **部署频率**: 频繁部署，用于快速迭代
- **访问地址**: 通常是独立的测试服务器

## 🔄 分支策略

### Git Flow 模式
```
main 分支 (生产)
├── 稳定的生产代码
├── 经过完整测试
└── 触发生产部署

develop 分支 (开发)
├── 最新的开发代码
├── 功能集成测试
└── 触发开发环境部署

feature/* 分支
├── 新功能开发
├── 不触发自动部署
└── 通过 PR 合并到 develop
```

## 💡 工作流优势

### 1. **环境隔离**
- 开发环境和生产环境完全分离
- 避免开发代码影响生产环境
- 支持并行开发和测试

### 2. **质量保证**
- 所有部署前都经过代码质量检查
- 构建测试确保 Docker 镜像正常
- 分阶段部署降低风险

### 3. **自动化流程**
- 代码推送自动触发相应环境部署
- 减少手动操作和人为错误
- 提高开发效率

## 🛠️ 实际工作流程

### 开发新功能
1. 在 `feature/new-feature` 分支开发
2. 完成后创建 PR 到 `develop` 分支
3. PR 合并后自动部署到开发环境 (`deploy-dev`)
4. 在开发环境测试功能
5. 测试通过后创建 PR 到 `main` 分支
6. 合并到 `main` 后自动部署到生产环境 (`deploy`)

### 当前项目状态
- **主要使用**: `deploy` (生产环境部署)
- **触发分支**: `main` 分支
- **部署目标**: 百度云服务器 (106.13.216.179)
- **deploy-dev**: 目前是占位符，可以根据需要配置具体的开发环境

## 🔧 配置建议

如果需要真正的开发环境，可以：

1. **配置独立的开发服务器**
2. **设置不同的环境变量**
3. **使用不同的数据库和服务**
4. **配置开发专用的域名**

## 📝 总结

- **deploy**: 生产环境部署，对应 `main` 分支
- **deploy-dev**: 开发环境部署，对应 `develop` 分支
- 两个环节实现了**环境分离**和**分阶段部署**
- 确保了代码质量和部署安全性

这种设计是现代 DevOps 的最佳实践，能够有效支持团队协作和持续集成/持续部署 (CI/CD)。
