# SSHå¯†é’¥æ­£ç¡®ä½¿ç”¨æŒ‡å— ğŸ”‘

## é‡è¦è¯´æ˜ï¼šä¸¤ç§å®Œå…¨ä¸åŒçš„SSHå¯†é’¥

### âŒ ä¹‹å‰çš„æ··æ·†
ä¹‹å‰çš„æ–‡æ¡£é”™è¯¯åœ°å°†ä¸¤ç§ä¸åŒç”¨é€”çš„SSHå¯†é’¥æ··ä¸ºä¸€è°ˆã€‚è¿™æ˜¯**é”™è¯¯çš„**ï¼

### âœ… æ­£ç¡®çš„åŒºåˆ†

## 1. GitHub Actions â†’ æœåŠ¡å™¨è¿æ¥å¯†é’¥

### ç”¨é€”
- **GitHub Actions è¿æ¥åˆ°æ‚¨çš„æœåŠ¡å™¨**
- ç”¨äºéƒ¨ç½²è¿‡ç¨‹ä¸­çš„SSHè¿æ¥

### ä½ç½®
- å­˜å‚¨åœ¨ **GitHub Secrets** ä¸­ä½œä¸º `SERVER_SSH_KEY`
- è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯†é’¥å¯¹ï¼Œä¸“é—¨ç”¨äºéƒ¨ç½²

### é…ç½®æ­¥éª¤
```bash
# 1. åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨æˆ–æœåŠ¡å™¨ä¸Šç”Ÿæˆéƒ¨ç½²å¯†é’¥
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/deploy_key

# 2. å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨çš„authorized_keys
cat ~/.ssh/deploy_key.pub >> /root/.ssh/authorized_keys

# 3. å°†ç§é’¥å†…å®¹å¤åˆ¶åˆ°GitHub Secrets
cat ~/.ssh/deploy_key
```

### GitHub Secretsé…ç½®
```
SERVER_SSH_KEY = [deploy_keyçš„ç§é’¥å†…å®¹]
SERVER_IP = [æ‚¨çš„æœåŠ¡å™¨IP]
SERVER_USER = root
```

## 2. æœåŠ¡å™¨ â†’ GitHubä»“åº“å…‹éš†å¯†é’¥

### ç”¨é€”
- **æœåŠ¡å™¨å…‹éš†/æ‹‰å–GitHubä»“åº“ä»£ç **
- ç”¨äº`git clone`å’Œ`git pull`æ“ä½œ

### ä½ç½®
- å­˜å‚¨åœ¨ **æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿ** `/root/.ssh/id_ed25519`
- å…¬é’¥éœ€è¦æ·»åŠ åˆ°GitHubè´¦æˆ·çš„SSHå¯†é’¥

### é…ç½®æ­¥éª¤
```bash
# 1. åœ¨æœåŠ¡å™¨ä¸Šç”ŸæˆGitæ“ä½œå¯†é’¥
ssh-keygen -t ed25519 -C "server-git-access" -f /root/.ssh/id_ed25519

# 2. å°†å…¬é’¥æ·»åŠ åˆ°GitHubè´¦æˆ·
cat /root/.ssh/id_ed25519.pub
# å¤åˆ¶è¾“å‡ºå†…å®¹ï¼Œåœ¨GitHubè®¾ç½®ä¸­æ·»åŠ SSHå¯†é’¥

# 3. æµ‹è¯•Gitè®¿é—®
ssh -T git@github.com
```

## å¯†é’¥ä½¿ç”¨æµç¨‹å›¾

```
GitHub Actions (éƒ¨ç½²)
       â†“ [ä½¿ç”¨ SERVER_SSH_KEY]
    æœåŠ¡å™¨ (Ubuntu 24.04)
       â†“ [ä½¿ç”¨ /root/.ssh/id_ed25519]
    GitHubä»“åº“ (ä»£ç å…‹éš†)
```

## å…³é”®åŒºåˆ«æ€»ç»“

| ç”¨é€” | å¯†é’¥ä½ç½® | GitHubé…ç½® | æœåŠ¡å™¨é…ç½® |
|------|----------|-------------|------------|
| **GitHub Actions â†’ æœåŠ¡å™¨** | GitHub Secrets: `SERVER_SSH_KEY` | åœ¨Secretsä¸­è®¾ç½®ç§é’¥ | åœ¨`authorized_keys`ä¸­æ·»åŠ å…¬é’¥ |
| **æœåŠ¡å™¨ â†’ GitHubä»“åº“** | æœåŠ¡å™¨: `/root/.ssh/id_ed25519` | åœ¨è´¦æˆ·è®¾ç½®ä¸­æ·»åŠ å…¬é’¥ | ç”Ÿæˆå¹¶å­˜å‚¨ç§é’¥ |

## é‡è¦æé†’

âš ï¸ **ç»å¯¹ä¸è¦**å°†æœåŠ¡å™¨ä¸Šçš„`/root/.ssh/id_ed25519`ç§é’¥å†…å®¹æ”¾å…¥GitHub Secretsä¸­ï¼

âœ… **æ­£ç¡®åšæ³•**ï¼š
1. ä¸ºGitHub Actionséƒ¨ç½²åˆ›å»ºä¸“é—¨çš„å¯†é’¥å¯¹
2. ä¸ºæœåŠ¡å™¨Gitæ“ä½œåˆ›å»ºä¸“é—¨çš„å¯†é’¥å¯¹  
3. ä¸¤è€…å®Œå…¨åˆ†ç¦»ï¼Œäº’ä¸å¹²æ‰°

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç”ŸæˆGitHub Actionséƒ¨ç½²å¯†é’¥**
2. **ç¡®è®¤æœåŠ¡å™¨Gitå¯†é’¥é…ç½®æ­£ç¡®**
3. **æ›´æ–°GitHub Secretsä½¿ç”¨æ­£ç¡®çš„éƒ¨ç½²å¯†é’¥**
4. **æµ‹è¯•ä¸¤ç§è¿æ¥éƒ½æ­£å¸¸å·¥ä½œ**
